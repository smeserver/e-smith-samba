Index: e-smith-samba/createlinks
diff -u e-smith-samba/createlinks:1.14 e-smith-samba/createlinks:1.15
--- e-smith-samba/createlinks:1.14	Wed Feb 23 11:48:53 2005
+++ e-smith-samba/createlinks	Fri Mar 11 11:41:54 2005
@@ -75,7 +75,7 @@
 
 $event = "workgroup-update";
 event_link("update-domain-group-maps", $event, "56");
-event_link("restart-dhcpd", $event, "90");
+safe_symlink("sigterm", "root/etc/e-smith/events/$event/services2adjust/dhcpd");
 safe_symlink("sigterm", "root/etc/e-smith/events/$event/services2adjust/smbd");
 
 $event = "printer-create";
Index: e-smith-samba/e-smith-samba.spec
diff -u /dev/null e-smith-samba/root/etc/e-smith/db/configuration/defaults/nmbd/status:1.1
--- /dev/null	Fri Mar 11 11:42:34 2005
+++ e-smith-samba/root/etc/e-smith/db/configuration/defaults/nmbd/status	Fri Mar 11 11:41:55 2005
@@ -0,0 +1 @@
+enabled
Index: e-smith-samba/root/etc/e-smith/db/configuration/defaults/nmbd/type
diff -u /dev/null e-smith-samba/root/etc/e-smith/db/configuration/defaults/nmbd/type:1.1
--- /dev/null	Fri Mar 11 11:42:34 2005
+++ e-smith-samba/root/etc/e-smith/db/configuration/defaults/nmbd/type	Fri Mar 11 11:41:55 2005
@@ -0,0 +1 @@
+service
Index: e-smith-samba/root/etc/e-smith/db/configuration/defaults/smbd/status
diff -u /dev/null e-smith-samba/root/etc/e-smith/db/configuration/defaults/smbd/status:1.1
--- /dev/null	Fri Mar 11 11:42:34 2005
+++ e-smith-samba/root/etc/e-smith/db/configuration/defaults/smbd/status	Fri Mar 11 11:41:55 2005
@@ -0,0 +1 @@
+enabled
Index: e-smith-samba/root/etc/e-smith/db/configuration/defaults/smbd/type
diff -u /dev/null e-smith-samba/root/etc/e-smith/db/configuration/defaults/smbd/type:1.1
--- /dev/null	Fri Mar 11 11:42:34 2005
+++ e-smith-samba/root/etc/e-smith/db/configuration/defaults/smbd/type	Fri Mar 11 11:41:55 2005
@@ -0,0 +1 @@
+service
Index: e-smith-samba/root/var/service/nmbd/run
diff -u e-smith-samba/root/var/service/nmbd/run:1.2 e-smith-samba/root/var/service/nmbd/run:1.3
--- e-smith-samba/root/var/service/nmbd/run:1.2	Tue Nov 18 14:03:57 2003
+++ e-smith-samba/root/var/service/nmbd/run	Fri Mar 11 11:41:55 2005
@@ -8,6 +8,14 @@
 #fi
 # We currently don't care about /etc/sysconfig/samba, but that may change.
 
+status=$(/sbin/e-smith/config getprop smb status)
+if [ "$status" = "disabled" ]
+then
+    /sbin/e-smith/config setprop nmbd status disabled
+    runsvctrl d .
+    exit
+fi
+
 nmbd=/usr/sbin/nmbd
 
 [ -f $nmbd ] || exit 1
Index: e-smith-samba/root/var/service/smbd/run
diff -u e-smith-samba/root/var/service/smbd/run:1.3 e-smith-samba/root/var/service/smbd/run:1.4
--- e-smith-samba/root/var/service/smbd/run:1.3	Tue Nov 18 14:03:57 2003
+++ e-smith-samba/root/var/service/smbd/run	Fri Mar 11 11:41:55 2005
@@ -8,6 +8,14 @@
 #fi
 # We currently don't care about /etc/sysconfig/samba, but that may change.
 
+status=$(/sbin/e-smith/config getprop smb status)
+if [ "$status" = "disabled" ]
+then
+    /sbin/e-smith/config setprop smbd status disabled
+    runsvctrl d .
+    exit
+fi
+
 smbd=/usr/sbin/smbd
 
 [ -f $smbd ] || exit 1
